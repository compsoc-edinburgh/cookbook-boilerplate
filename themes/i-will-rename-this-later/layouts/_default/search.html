<!DOCTYPE html>
<html lang="en">
  <head>
    {{ partial "preamble.html" }}
    <title>{{ .Site.Title }}</title>
  </head>
  <body>
    <div class="container">
      {{ partial "navbar.html" . }}
      <main>

        <h1 class="display-2 text-center mb-5">{{ .Title }}</h1>
        <div class="row">
          <section class="col-12 col-lg-3">
            <div class="sticky-lg-top filters">
              <!-- Search box -->
              <input class="form-control" name="q" id="search-query" type="text" placeholder="Search recipes" aria-label="Search Query">

              <!-- Some Filters -->
              <div class="accordion accordion-flush mt-5" id="searchFilters">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="filterAllergensHeading">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#filterAllergensBody" aria-expanded="false" aria-controls="filterAllergensBody">
                      Excluded Allergens
                    </button>
                  </h2>
                  <div id="filterAllergensBody" class="accordion-collapse collapse" aria-labelledby="filterAllergensHeading" data-bs-parent="#searchFilters">
                    <!-- accordion-body has to be strictly a child of the accordion-collapse class to prevent jumpy transitions:
                    https://stackoverflow.com/questions/38857162/bootstrap-collapse-has-a-jumpy-transition -->
                    <div class="accordion-body">
                      {{ range $allergen := slice "celery" "gluten" "crustaceans" "eggs" "fish" "lupin" "milk" "molluscs" "mustard" "nuts" "peanuts" "sesame seeds" "soya" "sulphites"}}
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="filter-allergens-{{ $allergen }}" name="filter-allergens-{{ $allergen }}">
                        <label class="form-check-label" for="filter-allergens-{{ $allergen }}">
                          {{ $allergen | title }}
                        </label>
                      </div>
                      {{ end }}
                    </div>
                  </div>

                  {{ range $key, $terms := $.Site.Taxonomies }}
                  {{ $capitalised := $key | title }}
                  <h2 class="accordion-header" id="filter{{ $capitalised }}Heading">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#filter{{ $capitalised }}Body" aria-expanded="false" aria-controls="filter{{ $capitalised }}Body">
                      {{ $key | title }}
                    </button>
                  </h2>
                  <div id="filter{{ $capitalised }}Body" class="accordion-collapse collapse" aria-labelledby="filter{{ $capitalised }}Heading" data-bs-parent="#searchFilters">
                    <div class="accordion-body">
                      {{ range $term, $pages := $terms }}
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="filter-{{ $key }}-{{ $term }}" name="filter-{{ $key }}-{{ $term }}" checked>
                        <label class="form-check-label" for="filter-{{ $key }}-{{ $term }}">
                          {{ $term | title }}
                        </label>
                      </div>
                      {{ end }}
                    </div>
                  </div>
                  {{ end }}

                </div>
              </div>
            </div>
          </section>
          <section class="col-12 col-lg-9">
            <ol class="recipe-listing row row-cols-2 row-cols-lg-3 g-4">
              {{ $paginator := .Paginate $.Site.RegularPages 12 }}

              {{ range $paginator.Pages }}
                <li class="recipe-listing-item col">
                  <a href="{{ .RelPermalink }}" role="article">
                    <div class="card h-100">
                      <img src="https://source.unsplash.com/random?{{ .Title }}" class="card-image-top mx-1 mt-1" alt="Placeholder courtesy of Unsplash. License: https://unsplash.com/license" />
                      <div class="card-body">
                        <span class="meta">{{ .Params.meals }} / {{ .Params.difficulties }}</span>
                        <h4 class="display-5 mt-lg-3">{{ .Title }}</h2>
                      </div>
                    </div>
                  </a>
                </li>
              {{ end }}
            </ol>
            <div class="d-flex justify-content-center mt-5">
              {{ template "_internal/pagination.html" . }}
            </div>
          </section>
        </div>
        <div class="add-recipe row row-cols-1 mb-4 d-none d-lg-block">
          <a href="https://github.com/{{ .Site.Params.cookbookRepo }}/new/main/?filename=main_courses/0-easy/foo.md&value=---%0Akeywords%3A%20%5Bbabylonian%2C%20fresh%2C%20vegetarian%5D%0Aallergens%3A%0A-%20milk%0Aserves%3A%2030%20cookies%0A---%0A%0A%23%20Grandma%27s%20Milk%20Chocolate%20Cookies%0A%0AThey%20always%20turn%20out%20delicious%21%0A%0A%23%23%20Ingredients%0A%0A%2A%2030g%20of%20molten%20hearts%0A%2A%2070g%20of%20unsalted%20butter%0A%2A%20100ml%20milk%0A%0A%23%23%20Blahblah&message=add%20my%20&delicious%20recipe">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Add your own recipe!</h5>
                <p class="card-text">The format is <i>super</i> simple, it won't take minutes!</p>
              </div>
            </div>
          </a>
        </div>
      </main>
      {{ partial "footer.html" . }}
    </div>
    {{ $style := resources.Get "/js/search.js" | resources.Minify | resources.Fingerprint }}
    <script src="{{ $style.Permalink }}"></script>
    {{ partial "postamble.html" }}
  </body>
</html>
